[buildout]
index = https://pypi.python.org/simple/

extensions = 
parts = 
    instance0
    instance1
    instance2
    instance3
    instancedebug
    omelette
    releaser
    zeoserver
    scripts
    backup

extends =
    https://dist.plone.org/release/5.1.7/versions.cfg
    versions.cfg
    
effective-user = www-data
show-picked-versions = true
versions = versions
find-links =
    https://dist.plone.org/release/5.1.7
    https://dist.plone.org/thirdparty/

http-address = 8480

policies = 
# policy packages

extensions = mr.developer
sources-dir = dev/
auto-checkout = 
    sinar.govdocs
    ploneun.vocabulary

[sources]
#sinar.pardocs=git https://github.com/sinar/sinar.pardocs branch=plone5
sinar.govdocs=git https://github.com/sinar/sinar.govdocs
ploneun.vocabulary=git https://github.com/ploneUN/ploneun.vocabulary

[mr.developer]
threads = 1

[instance0]
recipe = plone.recipe.zope2instance
eggs = 
    Plone
    Pillow
    plone.app.dexterity [grok]
    plone.app.theming
    plone.app.contenttypes
    collective.clamav
    collective.documentviewer
    collective.elasticsearch
    celery[sqlalchemy]
    collective.celery
#sinar.pardocs
    sinar.govdocs
    eea.facetednavigation
    ploneun.vocabulary
    ${buildout:policies}

products =

http-address = ${buildout:http-address}
user = admin:admin 
effective-user = ${buildout:effective-user}

zodb-cache-size = 3000

zeo-address = ${zeoserver:zeo-address}
zeo-client = on
shared-blob = on

zcml =
zcml-additional =
environment-vars =
        ZC_ASYNC_UUID ${buildout:directory}/var/instance-uuid.txt
        PYTHON_EGG_CACHE ${buildout:directory}/var
	BROKER_URL sqla+sqlite:///${buildout:directory}/celerydb.sqlite
	CELERY_RESULT_BACKEND db+sqlite:///${buildout:directory}/celeryresults.sqlite

[instance1]
<= instance0
http-address = 8481
zodb-cache-size = 3000

zeo-address = ${zeoserver:zeo-address}
zeo-client = on
shared-blob = on

zeo-client-cache-size = 512MB

[instance2]
<= instance0
http-address = 8482
zodb-cache-size = 3000

zeo-address = ${zeoserver:zeo-address}
zeo-client = on
shared-blob = on

zeo-client-cache-size = 512MB

[instance3]
<= instance0
http-address = 8483
zodb-cache-size = 3000

zeo-address = ${zeoserver:zeo-address}
zeo-client = on
shared-blob = on

zeo-client-cache-size = 512MB

[instancedebug]
<= instance0
http-address = 8489
zodb-cache-size = 3000

zeo-address = ${zeoserver:zeo-address}
zeo-client = on
shared-blob = on

zeo-client-cache-size = 512MB



[zeoserver]
recipe = plone.recipe.zeoserver
zeo-address = 8490
file-storage = ${buildout:directory}/var/filestorage/Data.fs
blob-storage = ${buildout:directory}/var/blobstorage/
effective-user = ${instance0:effective-user}
pack-days = 30

zeo-conf-additional =
    <filestorage 2>
        path ${buildout:directory}/var/filestorage/Async.fs
    </filestorage>

[omelette]
recipe = collective.recipe.omelette
eggs = ${instance0:eggs}

[scripts]
recipe = zc.recipe.egg
interpreter = zopepy
eggs = ${instance0:eggs}
scripts = pcelery

[backup]
recipe = collective.recipe.backup


[releaser]
recipe = collective.recipe.template
input = templates/releaser.py.in
output = ${buildout:bin-directory}/releaser.py
auto-release = ${buildout:auto-checkout}
